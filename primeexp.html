<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>Prime‑Derivative Match Matrix Explorer</title></head><body><script>const [L,I,D,P,B]=['label','input','div','performance',document.body],[C,T,S,H,W,J]=['className','textContent','style','innerHTML','width','checked'],e={},_=(t,p,a,n=document.createElement(t))=>{if(a)for(let k in a)k==S?Object.assign(n[S],a[k]):n[k]=a[k];return p&&p.appendChild(n),n},s=`body{background:#121212;color:#e0e0e0;font-family:monospace;margin:0;padding:20px}h1{margin-top:0}label{display:block;margin:8px 0 4px}input[type=number]{width:80px;padding:4px;background:#1e1e1e;border:1px solid #444;color:#e0e0e0}button{padding:6px 12px;background:#333;border:1px solid #666;color:#e0e0e0;cursor:pointer}button:disabled{background:#222;color:#666}#C{margin-top:16px;height:70vh;overflow:auto;border:1px solid #333}table{border-collapse:collapse}th,td{border:1px solid #333;width:2em;height:2em;text-align:center;font-size:11px}thead th{position:sticky;top:0;background:#1e1e1e}.r,.Z,.T,.p-w,.p-l{display:flex}.r{align-items:flex-end;flex-wrap:wrap;margin-bottom:10px}.g{display:inline-block;margin-right:10px}.Z{align-items:center;margin-left:15px;padding-bottom:5px}.Z label{margin:0 0 0 5px}.T{align-items:center;gap:15px;margin-bottom:15px}#A{flex-grow:1;display:none;flex-direction:column;gap:4px}.p-w{width:100%;height:12px;background:#333;border-radius:6px;overflow:hidden}.p-f{height:100%;width:0;transition:width .1s linear}#f-p{background-color:#4a90e2}#f-d{background-color:#9013fe}#f-m{background-color:#50e3c2}#f-r{background-color:#f5a623}.p-l span{flex:1;text-align:center}.p-e span{color:#8ab4f8;font-style:italic}#p-t{font-size:14px;color:#50e3c2;text-align:center;margin-top:4px;display:none}`;_('style',B.parentNode.firstChild,{[T]:s});const r1=_(D,B,{[C]:'r'}),r2=_(D,B,{[C]:'r'}),Hl=(p,a)=>{let d=_(D,p,{[C]:'g'});_(L,d,{[T]:a[0]}),e[a[1]]=_(I,d,{id:a[1],type:'number',value:a[2],min:a[3]})};_('h1',B,{[T]:'Prime‑Derivative Match Matrix Explorer'});[['N Primes','N',1e3,10,r1],['Depth','K',100,1,r1],['Matrix Size','M',100,2,r2],['Row Start','RS',0,0,r2],['Row End','RE',99,0,r2],['Col Start','CS',0,0,r2],['Col End','CE',99,0,r2]].forEach(a=>Hl(a[4],[...a]));const z=_(D,r2,{[C]:'Z'});e.Z=_(I,z,{type:'checkbox',id:'Z',title:'Zoom'});_(L,z,{htmlFor:'Z',[T]:'Zoom'});const Tb=_(D,B,{[C]:'T'});e.B=_(...['button',Tb,{[T]:'Generate'}]);const pA=_(D,Tb,{id:'A'}),pL1=_(D,pA,{[C]:'p-l'}),pB=_(D,pA,{[C]:'p-w'}),pL2=_(D,pA,{[C]:'p-l p-e'}),TS=[['Primes','p',.25],['Derivatives','d',.25],['Matrix','m',.25],['Render','r',.25]];TS.forEach(([n,t])=>{_('span',pL1,{id:`cat-${t}`,[T]:n}),e[`f-${t}`]=_(D,pB,{id:`f-${t}`,[C]:'p-f'}),e[`e-${t}`]=_('span',pL2,{id:`e-${t}`})});e.pT=_(D,pA,{id:'p-t'});const O=_(D,B,{id:'C'}),q=_('table',O);e.h=_('thead',q);e.b=_('tbody',q);const ws=`let S={},Q=postMessage,L=Math.log,A=Math.abs;const F=m=>m<1e3?\`\${m.toFixed(0)}ms\`:((s=m/1e3)<60?\`\${s.toFixed(1)}s\`:\`\${s/60|0}m \${s%60}s\`),T=m=>!isFinite(m)||m<0?"":\`ETA \${F(m)}\`,R=(t,c,k)=>{const n=performance.now();S[t]||(S[t]={s:n});const p=c/k*100,d=c>=k;if(d)return Q({type:"progress",payload:{task:t,percent:100,doneTime:n-S[t].s}});Q({type:"progress",payload:{task:t,percent:p,eta:p>1?T((n-S[t].s)/c*(k-c)):""}})},p=n=>{R("p",0,n);const M=Math.ceil(n*(L(n)+L(L(n))))+10,S=new Uint8Array(M),P=[];for(let i=2,I=n/100|0||1;i<M&&P.length<n;i++)if(!S[i]){P.push(i),P.length%I==0&&R("p",P.length,n);for(let j=i*i;j<M;j+=i)S[j]=1}return R("p",n,n),P},d=(s,k,N)=>{R("d",0,k);const D=[new Int32Array(s)];let c=D[0];for(let i=1,T=N>1e5?Int16Array:Int8Array,I=k/100|0||1;i<=k;i++){if(c.length<=1)return R("d",k,k),D;const n=new T(c.length-1);let a=!0;for(let j=0;j<n.length;j++){const v=A(c[j+1])-A(c[j]);v&&(a=!1),n[j]=v}D.push(c=n),(i%I==0||i==k)&&R("d",i,k);if(a)return R("d",k,k),D}return D},l=(a,b)=>{let n=Math.min(a.length,b.length),r=0,m=0;for(let i=0;i<n;i++)a[i]===b[i]?(r++,r>m&&(m=r)):r=0;return m},b=(D,rs,re,cs,ce)=>{const T=re-rs+1;R("m",0,T);const M=Array.from({length:T},()=>new Uint16Array(ce-cs+1));let x=0;for(let i=rs,I=T/100|0||1;i<=re;i++){for(let j=cs;j<=ce;j++){const v=i===j?0:l(D[i],D[j]);v>x&&(x=v),M[i-rs][j-cs]=v}const p=i-rs+1;(p%I==0||p===T)&&R("m",p,T)}return{M,x}};self.onmessage=({data})=>{S={};Q({type:"start"});const P=p(data.N),D=d(P,data.K,data.N),{M,x}=b(D,data.rs,data.re,data.cs,data.ce);Q({type:"result",payload:{M,x,...data}})};`,Cg=(v,m)=>`rgb(${18+169*(m?v/m:0)|0},${18+116*(m?v/m:0)|0},${18+234*(m?v/m:0)|0})`,F=ms=>ms<1e3?`${ms.toFixed(0)}ms`:(s=ms/1e3)<60?`${s.toFixed(2)}s`:`${s/60|0}m ${(s%60).toFixed(2)}s`,U=(t,p,m,d)=>{let [,,w]=TS.find(x=>x[1]==t);e[`f-${t}`][S][W]=`${p*w}%`,e[`e-${t}`][T]=d?`Done: ${F(m)}`:`${m}`};let w,G;const R=p=>{const s=window[P].now();U('r',0,'ETA...',!1),e.h[H]='<tr><th></th>'+[...Array(p.ce-p.cs+1)].map((_,i)=>`<th>D<sub>${p.cs+i}</sub></th>`).join('')+'</tr>';let h='';p.M.forEach((W,i)=>{h+=`<tr><th>D<sub>${p.rs+i}</sub></th>${[...W].map(v=>`<td style="background-color:${Cg(v,p.x)}">${v}</td>`).join('')}</tr>`}),e.b[H]=h;U('r',100,window[P].now()-s,!0);e.pT[T]=`Total: ${F(window[P].now()-G)}`;e.pT[S].display='block';e.B.disabled=0,w.terminate()};e.B.onclick=()=>{let p,m=+e.M.value-1;p=e.Z[J]?{rs:+e.RS.value,re:+e.RE.value,cs:+e.CS.value,ce:+e.CE.value}:{rs:0,cs:0,re:m<0?0:m,ce:m<0?0:m};Object.assign(p,{N:+e.N.value,K:+e.K.value});if(p.rs>p.re||p.cs>p.ce||p.K<p.re||p.K<p.ce)return alert('Invalid range or depth');w&&w.terminate();G=window[P].now();w=new Worker(URL.createObjectURL(new Blob([ws],{type:'text/javascript'})));e.B.disabled=1;w.onmessage=({data:{type:t,payload:d}})=>t=='start'?(pA[S].display='flex',e.pT[S].display='none',TS.forEach(([,t])=>{e[`f-${t}`][S][W]='0%',e[`e-${t}`][T]=""})):t=='progress'?U(d.task,d.percent,d.doneTime??d.eta,!!d.doneTime):requestAnimationFrame(()=>R(d));w.onerror=E=>{console.error(E),pA[S].display='none',e.B.disabled=0},w.postMessage(p)};</script></body></html>
